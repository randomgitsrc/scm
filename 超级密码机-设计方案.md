# 超级密码机 - 移动端H5游戏设计方案

## 一、产品定位与核心体验

**产品定义**：一款单指操作、单手掌握的密码推理益智游戏，继承经典Mastermind玩法，适配手机竖屏碎片化场景。

**核心体验目标**：
- **即时反馈**：每一次点击都有视觉+音效的确定性回应
- **零学习成本**：3秒内理解"填4个颜色→看提示→调整"的循环
- **掌机质感**：通过震动、音效、复古军绿视觉营造实体玩具触感

**游戏模式**：仅保留**经典闯关模式**（无限关卡，难度自适应，支持存档续玩）

---

## 二、核心游戏规则（精简版）

### 2.1 基础参数
- **密码长度**：4位
- **颜色库**：7色（红、黄、蓝、绿、紫、橙、青）
- **尝试次数**：7行（固定7次机会）
- **难度机制**：前10关"不重复颜色"，第11关起"可重复颜色"（自动切换，无需用户选择）

### 2.2 反馈机制（双重提示）
沿用实体机标准规则：
- **🔴 红灯（实体机绿灯）**：位置和颜色都正确（A）
- **⚪ 白灯**：颜色正确但位置错误（B）
- **⚫ 无灯**：该颜色不存在于密码中

**反馈计算示例**：
- 正确答案：[红, 蓝, 黄, 绿]
- 玩家猜测：[红, 黄, 紫, 蓝]
- 反馈：1红（红对位）+ 2白（黄和蓝存在但错位）+ 紫无

### 2.3 游戏流程
```
生成4位密码 → 玩家填第1行 → 验证显示反馈 → 填第2行 → ... → 
第7行失败（揭示答案）/ 任意行全对（胜利+下一关）
```

---

## 三、手机端界面架构设计

### 3.1 屏幕布局（竖屏 375×812基准）

采用**"三区三段式"**布局，适配单手握持：

```
┌─────────────────────────────────────┐  ← 安全区顶部
│  [设置]    超级密码机    [音效]     │  ← 状态栏（40px）
├─────────────────────────────────────┤
│                                     │
│   ◐  ◑          ～～～            │  ← 视觉区（80px）
│  （双天线动画 + 信号波纹）          │
│                                     │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ ████ [●○]                   │   │
│  │ ████ [●●]                   │   │
│  │ ...（7行历史记录区）         │   │  ← 游戏主区（45%）
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  [ ○ ] [ ○ ] [ ○ ] [ ○ ]          │  ← 当前输入区（80px）
│   1      2      3      4          │
│   （带编号的输入槽）               │
├─────────────────────────────────────┤
│                                     │
│  [红][黄][蓝][绿]                  │  ← 色盘区（25%）
│  [紫][橙][青]                      │   7色大按钮
│                                     │
├─────────────────────────────────────┤
│       [    验   证    ]            │  ← 操作区（80px）
│         （大按钮）                  │
└─────────────────────────────────────┘  ← 安全区底部（iOS Handle）
```

### 3.2 组件详细规格

#### A. 顶部视觉区（装饰性氛围）
- **双天线**：简化成顶部两角的LED指示灯
  - 左天线（红色）：游戏进行中常亮
  - 右天线（绿色）：验证通过/胜利时闪烁
- **信号波纹**：CSS动画模拟无线电波扩散，营造"正在破译"氛围

#### B. 历史记录区（核心信息区）
- **7行固定**：从上到下排列，代表第1-7次尝试
- **每行结构**：
  - 左侧4个色块（圆角矩形，显示该次猜测的颜色）
  - 右侧2×2提示灯矩阵（小圆点，显示红/白反馈）
- **视觉状态**：
  - 已填行：正常显示
  - 当前活跃行：左侧有箭头指示器，背景高亮
  - 空行：浅灰色占位符轮廓

#### C. 当前输入区（操作焦点）
- **4个输入槽**：水平等分，带数字标签1-4
- **槽位状态**：
  - **空槽**：深灰背景，细边框，显示数字1-4
  - **已填槽**：填充颜色，边框发光，数字隐藏
  - **活跃槽**（当前要填的位）：霓虹绿脉冲边框，每1.5s闪烁一次
  - **待验证**：4槽全满后，整体发出微光，提示可提交

#### D. 色盘区（触摸优化）
- **7色大按钮**：圆形，直径56px（符合iOS人机指南最小触摸区44px+padding）
- **排列**：首行4个（红、黄、蓝、绿），次行3个居中（紫、橙、青）
- **交互态**：
  - 按下：缩放至0.9，内阴影加深，震动反馈（Vibration API）
  - 禁用色：若某颜色已被证实不存在（通过之前反馈），显示半透明阴影

#### E. 验证按钮区（明确CTA）
- **大按钮**：宽度80%，高度48px，圆角24px
- **状态变化**：
  - 未填满：灰色，文字"填满4位"，禁用态
  - 已填满：橙色渐变，文字"验证密码"，可点击
  - 点击后：立即进入验证动画，按钮显示加载旋转图标

---

## 四、手机端交互设计（关键创新）

### 4.1 输入流程优化（解决实体机"长按"不适合触摸的问题）

**新机制：自动提交（Auto-Commit）+ 手动修改**

1. **自动填充**：点击色盘 → 颜色立即填入当前**活跃槽位** → 自动跳至**下一个空槽**
2. **智能跳转逻辑**：
   - 若第1位空，填第1位，光标→第2位
   - 若第1位有值第2位空，填第2位，光标→第3位
   - **若4位全满**，最后点击的颜色**替换第4位**（覆盖而非追加），光标保持在第4位
   
3. **修改机制**：
   - **点击已填槽位**：清空该位，光标定位至此，其余位保留
   - **左滑清空手势**：在历史记录区或输入区左滑，弹出"清空当前行"确认（防误触）

4. **提交验证**：
   - **点击大验证按钮**（替代实体机长按键，更适合触屏）
   - **防连点机制**：提交后1.5s锁屏（验证动画期间不可操作）

### 4.2 手势操作清单

| 手势 | 作用区域 | 功能 | 视觉反馈 |
|------|----------|------|----------|
| **Tap** | 色盘 | 选色填入当前活跃位 | 按钮下沉+颜色滑入槽位 |
| **Tap** | 已填槽位 | 修改该位（清空） | 槽位弹跳，颜色滑出 |
| **Tap** | 验证按钮 | 提交当前4位 | 按钮高亮，全屏扫描动画 |
| **Swipe Left** | 输入区 | 清空当前行 | 整行颜色向左滑出 |
| **Long Press** | 某颜色 | 标记为"已排除"（视觉辅助） | 颜色变灰，打叉标记 |

### 4.3 防误触设计（移动端关键）

- **延迟提交**：实体机的"长按确认"在手机上容易误触，改为**点击验证按钮+动画锁定期**
- **二次确认**：仅在"清空当前行"和"放弃游戏"时需要确认弹窗
- **热区缓冲**：色盘按钮实际可点击区域比视觉大8px（透明外扩），减少边缘误点
- **震动反馈**：每次有效点击提供5ms轻震（支持设备上），无效操作（如点击满行）提供30ms警告震

---

## 五、视觉与动效规范

### 5.1 色彩系统（CSS变量）

```css
/* 主色调 */
--bg-army: #3D4A1E;        /* 军绿背景 */
--panel-dark: #1C1C1E;     /* 深灰面板 */
--led-red: #FF3B30;        /* 正确位置提示（对应实体机绿灯，用红色更醒目）*/
--led-white: #F0F0F0;      /* 颜色对位置错 */
--button-orange: #FF9500;  /* 验证按钮 */

/* 7色盘（饱和度略低，护眼）*/
--c-red: #FF6B6B;
--c-yellow: #FFD93D;
--c-blue: #4D96FF;
--c-green: #6BCB77;
--c-purple: #9B59B6;
--c-orange: #FF9F45;
--c-cyan: #48DBFB;
```

### 5.2 关键动效定义

| 交互节点 | 动画描述 | 时长 | 目的 |
|---------|---------|------|------|
| **颜色填入** | 颜色从色盘"飞入"对应槽位（路径动画） | 0.3s | 建立操作与结果的因果关系 |
| **槽位活跃** | 边框呼吸灯（opacity 0.3→1→0.3循环） | 1.5s | 明确当前输入位置 |
| **验证扫描** | 横向激光线从上至下扫过输入区，LED灯依次点亮 | 0.8s | 营造"机器正在计算"的仪式感 |
| **提示灯亮起** | 从小到大弹出（scale 0→1.2→1）+ 发光 | 0.2s each | 正向反馈，类似中奖快感 |
| **行切换** | 新行从右侧滑入，旧行轻微上移压缩 | 0.4s | 空间感知，明确进度推进 |
| **胜利庆祝** | 天线LED疯狂闪烁 + 彩带粒子 + 标题缩放 | 2s | 成就感峰值 |
| **错误震动** | 输入区左右摇摆（±5px，3次） | 0.4s | 明确错误，不中断流程 |

### 5.3 拟物化细节（保留实体机质感）

- **材质感**：所有按钮使用内阴影模拟凹陷，外阴影模拟凸起，营造物理按键触感
- **LED发光**：提示灯使用多层box-shadow（内白外彩）模拟真实LED光晕
- **栅格纹理**：背景添加细微的5%透明度栅格纹理，模拟军工设备表面

---

## 六、游戏流程详细设计

### 6.1 开局流程（First Time UX）

1. **启动页**：Logo + 音效（无线电杂音渐变为开机音）+ 加载条（模拟系统启动）
2. **首关教学**（仅在第1关显示）：
   - 半透明遮罩覆盖界面
   - Step1高亮色盘："点击选择颜色"
   - Step2高亮输入区："填满4个位置"
   - Step3高亮验证按钮："点击验证"
   - Step4高亮反馈区："红灯=位置对，白灯=颜色对"
   - 提供"跳过教学"按钮

### 6.2 单局游戏循环（详细状态机）

```
[初始状态]
├─ 系统生成4位密码（玩家不可见）
├─ 当前行=第1行，活跃槽位=1号
├─ 输入区为空，验证按钮灰色禁用

[输入中状态]
├─ 玩家点击色盘 → 颜色填入活跃槽位
├─ 若槽位1-3：自动跳转下一槽位（活跃槽位+1）
├─ 若槽位4：填满，验证按钮变为橙色可点击，追加"闪烁"动画提示
└─ 玩家可点击任意已填槽位修改（清空该位，活跃槽位移至该位）

[验证状态]（点击验证按钮触发）
├─ 锁屏（禁止操作）
├─ 播放0.8s扫描动画
├─ 计算反馈（红/白灯数量）
├─ 在历史行右侧显示提示灯（动画依次点亮）
└─ 判定：
    ├─ 4红 → 胜利流程
    ├─ 非4红且当前行<7 → 推进至下一行，返回[输入中状态]
    └─ 非4红且当前行=7 → 失败流程

[胜利流程]
├─ 胜利音效（ triumphant chord）
├─ 天线绿灯闪烁2s
├─ 弹窗显示：本关步数、用时、评价（如"推理大师"）
├─ 按钮：[下一关] [再玩一次] [分享]
└─ 自动保存进度

[失败流程]
├─ 失败音效（低沉buzzer）
├─ 显示正确答案（4色高亮闪烁）
├─ 按钮：[再试一次] [查看历史记录]
└─ 不保存进度（可无限重试本关）
```

### 6.3 辅助功能

- **提示系统**：第4次尝试失败后，显示"?"按钮，点击后排除一个确定错误的颜色（该颜色在所有历史反馈中都是"无"或已用完所有可能位置）
- **历史回看**：点击任意历史行，该行展开显示详细推导注释（可选功能，作为新手辅助）
- **暂停菜单**：点击顶部设置图标，可开关音效、重置本关、返回主菜单（主菜单仅显示当前关卡数和最高分）

---

## 七、技术指标与边界情况

### 7.1 性能指标
- **加载时间**：首屏≤2s（3G网络），总包体<300KB（单HTML内联所有资源）
- **帧率**：动画期间保持60fps，使用CSS动画而非JS计算
- **内存**：单局游戏内存占用<30MB，无内存泄漏（及时清理DOM事件监听）

### 7.2 兼容性
- **系统**：iOS 14+（Safari）、Android 8+（Chrome）、微信内置浏览器
- **特性降级**：
  - 不支持Vibration API的设备：视觉反馈替代（屏幕闪烁）
  - 不支持Web Audio API的设备：静默模式，无音效但不阻断游戏
- **横屏处理**：检测到orientation为landscape时，显示"请竖屏游戏"提示，暂停游戏逻辑

### 7.3 边界处理
- **颜色重复逻辑**：困难模式下，反馈算法正确处理重复色（如秘密[红,红,蓝,绿]，猜测[红,红,红,黄] → 反馈2红，因为只猜对2个位置，第三个红虽然颜色对但超额）
- **快速点击**：防连点器，验证动画播放期间（1.5s）无视所有点击
- **异常退出**：每完成一行提交自动保存游戏状态（LocalStorage），重新进入游戏时检测存档并提示"是否继续上次游戏？"

---

## 八、开发检查清单（供参考）

- [ ] 7色色盘在手机屏幕上无重叠，按钮间距≥8px
- [ ] 点击色盘后，颜色正确填入当前活跃槽位，且槽位有视觉变化
- [ ] 填满4位后，验证按钮由灰变橙，有明显视觉提示
- [ ] 点击验证后，有0.8s的扫描动画，期间无法操作
- [ ] 反馈灯（红/白）正确计算并显示（测试用例：秘密[红蓝黄绿]，猜测[红黄紫蓝] → 1红2白）
- [ ] 7次错误后显示正确答案，并有明显的"再试一次"按钮
- [ ] 胜利后弹出统计页面，并有关卡推进逻辑
- [ ] 支持LocalStorage存档，刷新页面可恢复当前局
- [ ] iOS Safari底部安全区适配（输入区不被Home条遮挡）
- [ ] 横屏时显示旋转提示，游戏暂停

---

此设计方案已将实体机的**核心推理乐趣**完整移植到手机触屏环境，同时通过**自动跳转、大触控区、明确的状态提示**解决了实体按键与触摸屏的交互差异。开发者按此方案可实现一款"单指可玩、3秒上手、具有实体玩具质感"的手机网页游戏。